# ðŸš€ Kubernetes Cluster Add-Ons with Installation Examples

---

## 1. **CoreDNS (DNS Add-On)**

ðŸ‘‰ Installed by default with `kubeadm`. You only scale/manage it.

### Example: Scale to 2 replicas

```bash
kubectl -n kube-system scale deployment coredns --replicas=2
kubectl get pods -n kube-system -l k8s-app=kube-dns
```

### Example: Patch CoreDNS config

```bash
kubectl -n kube-system edit configmap coredns
```

---

## 2. **CNI Plugin (Networking)**

You must install **one CNI** after `kubeadm init`.

### Example: Install Flannel

```bash
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
```

### Example: Install Calico

```bash
kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.28.0/manifests/calico.yaml
```

Check pods:

```bash
kubectl get pods -n kube-system -o wide
```

---

## 3. **kube-proxy**

ðŸ‘‰ Installed by kubeadm as a DaemonSet.

### Example: Switch to IPVS mode

Edit config:

```bash
kubectl -n kube-system edit configmap kube-proxy
```

Change:

```yaml
mode: "ipvs"
```

Restart pods:

```bash
kubectl -n kube-system delete pod -l k8s-app=kube-proxy
```

---

## 4. **Metrics Server**

Provides resource metrics for `kubectl top` and HPA.

### Install metrics-server

```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

### Verify

```bash
kubectl top nodes
kubectl top pods
```

---

## 5. **Ingress Controller (NGINX Example)**

### Install

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.11.1/deploy/static/provider/cloud/deploy.yaml
```

### Verify

```bash
kubectl get pods -n ingress-nginx
kubectl get svc -n ingress-nginx
```

---

## 6. **Storage Add-Ons (CSI)**

### Example: Local Path Provisioner (for bare-metal/minikube)

```bash
kubectl apply -f https://raw.githubusercontent.com/rancher/local-path-provisioner/master/deploy/local-path-storage.yaml
```

### Verify

```bash
kubectl get storageclass
```

---

## 7. **Dashboard**

### Install

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
```

### Access

```bash
kubectl proxy
```

Open: [http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https\:kubernetes-dashboard:/proxy/](http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/)

---

## 8. **Logging Add-Ons (Loki Example)**

### Install with Helm

```bash
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
helm install loki grafana/loki-stack --namespace logging --create-namespace
```

### Verify

```bash
kubectl get pods -n logging
```

---

## 9. **cert-manager**

### Install

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.16.2/cert-manager.yaml
```

### Verify

```bash
kubectl get pods -n cert-manager
```

---

## 10. **Cluster Autoscaler (Cloud only)**

### Example: For AWS

```bash
kubectl apply -f https://github.com/kubernetes/autoscaler/releases/download/cluster-autoscaler-1.30.0/cluster-autoscaler-autodiscover.yaml
```

Update deployment with your cloud details (tags, node group names, etc.).

---

# âœ… Recommended Installation Order

1. **CoreDNS** (already there, just scale if needed).
2. **CNI Plugin** (Flannel/Calico).
3. **Metrics Server**.
4. **Ingress Controller**.
5. **cert-manager** (if TLS needed).
6. **Storage (CSI driver)**.
7. **Monitoring (Prometheus/Grafana)**.
8. **Logging (Loki/EFK)**.
9. **Dashboard (optional)**.
10. **Cluster Autoscaler (cloud only)**.

---

âš¡ **Tip for automation with Ansible:**
Each of these can be written as an Ansible task:

```yaml
- name: Install metrics-server
  ansible.builtin.command: >
    kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

---
